<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Content Search Widget</title>
<style>
  :root {
    --bg: #1e1e1e;
    --card: #2a2a2a;
    --accent: #3b82f6;
    --accent-hover: #2563eb;
    --copy: #6366f1;
    --copy-hover: #4f46e5;
    --text: #f1f1f1;
    --subtle: #9ca3af;
    --success: #10b981;
    --success-hover: #059669;
  }
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
  body, html {
    background: var(--bg);
    color: var(--text);
    font-family: 'Segoe UI', system-ui, sans-serif;
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  .container {
    background: var(--card);
    border-radius: 16px;
    padding: 24px;
    max-width: 480px;
    width: 100%;
    box-shadow: 0 6px 20px rgba(0,0,0,0.3);
    text-align: center;
  }
  h1 { font-size: 20px; margin-bottom: 4px; }
  .subtitle, .version {
    font-size: 12px;
    color: var(--subtle);
  }
  .version { font-size: 11px; margin-top: 24px; }
  input, button {
    width: 100%;
    padding: 12px;
    font-size: 15px;
    border-radius: 8px;
    border: 1px solid #444;
    background: var(--bg);
    color: var(--text);
    margin-top: 8px;
    cursor: pointer;
    transition: background 0.3s;
  }
  input { margin-bottom: 10px; }
  button { border: none; }
  #buscarBtn { background: var(--accent); }
  #buscarBtn:hover { background: var(--accent-hover); }
  #autopopularBtn { background: var(--copy); }
  #autopopularBtn:hover { background: var(--copy-hover); }
  #copiarBtn {
    background: var(--success);
    display: none;
  }
  #copiarBtn:hover { background: var(--success-hover); }
  #resultado img {
    width: 100%;
    border-radius: 10px;
    box-shadow: 0 3px 12px rgba(0,0,0,0.4);
    margin-top: 14px;
    opacity: 0;
    transition: opacity 0.5s ease;
  }
  #resultado img.mostrar { opacity: 1; }
  #mensaje {
    font-size: 13px;
    color: #7fffd4;
    margin-top: 10px;
    min-height: 18px;
  }
</style>
</head>
<body>
  <div class="container">
    <h1>Content Search Widget</h1>
    <div class="subtitle">For Notion ‚Äì By SatanLv</div>
    <input type="text" id="searchTerm" placeholder="Escribe algo como 'El Viaje de Chihiro'" />
    <button id="buscarBtn">Search on the Web</button>
    <button id="autopopularBtn">Copy Info</button>

    <div id="resultado"></div>
    <div id="mensaje"></div>
    <button id="copiarBtn">Copy Image Link</button>

    <div class="version">v3.7</div>
  </div>

<script>
  const googleApiKey = 'AIzaSyCIOzztenhY4A_knS4Rqa1E31dpAz_qUNw';
  const googleCx = '755902b769ce14965';
  const omdbApiKey = 'aacdb68f';

  const $ = id => document.getElementById(id);

  const input = $('searchTerm');
  const buscarBtn = $('buscarBtn');
  const autopopularBtn = $('autopopularBtn');
  const copiarBtn = $('copiarBtn');
  const mensaje = $('mensaje');
  const resultado = $('resultado');

  let ultimoLink = '';

  input.addEventListener('keypress', e => { if (e.key === 'Enter') buscarImagen(); });
  buscarBtn.addEventListener('click', buscarImagen);
  copiarBtn.addEventListener('click', async () => {
    if (!ultimoLink) return;
    try {
      await navigator.clipboard.writeText(ultimoLink);
      mensaje.textContent = '‚úÖ Image link copied!';
    } catch {
      mensaje.textContent = '‚ùå Copy failed.';
    }
  });
  autopopularBtn.addEventListener('click', copiarInfoOMDb);

  const traducirATituloIngles = async (texto) => {
    const res = await fetch("https://libretranslate.de/translate", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ q: texto, source: "auto", target: "en", format: "text" })
    });
    if (!res.ok) throw new Error('Error en traducci√≥n');
    const data = await res.json();
    return data.translatedText;
  };

  async function buscarImagen() {
    const term = input.value.trim();
    if (!term) return alert('Please enter a search term.');

    mensaje.textContent = '';
    copiarBtn.style.display = 'none';
    resultado.innerHTML = '';
    ultimoLink = '';

    try {
      const resImg = await fetch(
        `https://www.googleapis.com/customsearch/v1?key=${googleApiKey}&cx=${googleCx}&searchType=image&imgSize=xxlarge&q=${encodeURIComponent(term)}&num=1`
      );
      if (!resImg.ok) throw new Error('Error fetching image');
      const dataImg = await resImg.json();

      if (!dataImg.items?.length) {
        resultado.textContent = 'No image found.';
        return;
      }

      const imgSrc = dataImg.items[0].link;
      ultimoLink = imgSrc;

      const img = new Image();
      img.src = imgSrc;
      img.onload = () => img.classList.add('mostrar');
      resultado.appendChild(img);

      try {
        await navigator.clipboard.writeText(imgSrc);
        mensaje.textContent = '‚úÖ Image link copied!';
      } catch {
        copiarBtn.style.display = 'block';
        mensaje.textContent = 'Click the button to copy.';
      }
    } catch (error) {
      resultado.textContent = 'Error fetching image.';
      console.error(error);
    }
  }

  async function copiarInfoOMDb() {
    const termOriginal = input.value.trim();
    if (!termOriginal) {
      mensaje.textContent = 'Please enter a title.';
      return;
    }

    mensaje.textContent = 'Translating & fetching info...';

    try {
      const termEN = await traducirATituloIngles(termOriginal);

      const res = await fetch(
        `https://www.omdbapi.com/?apikey=${omdbApiKey}&t=${encodeURIComponent(termEN)}&plot=full`
      );
      if (!res.ok) throw new Error('Error fetching OMDb');
      const data = await res.json();

      if (data.Response === "False") {
        mensaje.textContent = '‚ùå Movie not found.';
        return;
      }

      const {
        Title: title = '',
        Year: year = '',
        Runtime: runtime = '',
        Plot: plot = 'Sinopsis no disponible.',
        Director: director = 'Desconocido',
        Actors: actors = 'No listado',
        Awards: awards = 'No disponible',
        Ratings: ratings = []
      } = data;

      const imdb = ratings.find(r => r.Source === "Internet Movie Database")?.Value || 'No disponible';
      const rt = ratings.find(r => r.Source === "Rotten Tomatoes")?.Value || 'No disponible';

      const formatted = 
        `üìù **SINOPSIS**\n${plot}\n\n` +
        `üé¨ **INFORMACI√ìN**\n‚Ä¢ T√≠tulo: ${title}\n‚Ä¢ A√±o: ${year}\n‚Ä¢ Duraci√≥n: ${runtime}\n‚Ä¢ Director: ${director}\n‚Ä¢ Reparto: ${actors}\n\n` +
        `üèÜ **PREMIOS**\n${awards}\n\n` +
        `üéØ **CALIFICACIONES**\n- ‚≠ê IMDb: ${imdb}\n- üçÖ Rotten Tomatoes: ${rt}`;

      await navigator.clipboard.writeText(formatted);
      mensaje.textContent = '‚úÖ Info copied from OMDb!';
    } catch (e) {
      console.error(e);
      mensaje.textContent = '‚ùå Error fetching from OMDb.';
    }
  }
</script>
</body>
</html>
